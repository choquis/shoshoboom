{
  "associatedLayout": "Test Scene",
  "name": "PerspectiveGround",
  "events": [
    {
      "colorB": 82,
      "colorG": 68,
      "colorR": 62,
      "creationTime": 0,
      "name": "Perspective ground logic",
      "source": "",
      "type": "BuiltinCommonInstructions::Group",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 52,
            "g": 44,
            "r": 40,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "On start we save the initial X,Y, Width and Height of the sprite.\nThis only works by the positive side of the Y coordinates and its hardcoded 32 for sprite width and 360 window width."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "DepartScene"
              },
              "parameters": [
                ""
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "AnimatableCapability::AnimatableBehavior::PauseAnimation"
              },
              "parameters": [
                "PerspectiveGround",
                "Animation"
              ]
            },
            {
              "type": {
                "value": "SetNumberVariable"
              },
              "parameters": [
                "LastCameraX",
                "=",
                "CameraCenterX(_CONSTANTS_.Layers.Main, 0)"
              ]
            },
            {
              "type": {
                "value": "SetNumberVariable"
              },
              "parameters": [
                "LastCameraY",
                "=",
                "CameraCenterY(_CONSTANTS_.Layers.Main, 0)"
              ]
            }
          ],
          "events": [
            {
              "type": "BuiltinCommonInstructions::ForEach",
              "object": "PerspectiveGround",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "SetNumberObjectVariable"
                  },
                  "parameters": [
                    "PerspectiveGround",
                    "InitialY",
                    "=",
                    "PerspectiveGround.Y()"
                  ]
                },
                {
                  "type": {
                    "value": "SetNumberObjectVariable"
                  },
                  "parameters": [
                    "PerspectiveGround",
                    "InitialX",
                    "=",
                    "PerspectiveGround.X()"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::CompareNumbers"
                      },
                      "parameters": [
                        "PerspectiveGround.InitialX",
                        ">",
                        "320"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "FlippableCapability::FlippableBehavior::FlipX"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "Flippable",
                        "yes"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "FlippableCapability::FlippableBehavior::FlippedX"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "Flippable"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ChangeSprite"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "=",
                        "trunc((PerspectiveGround. InitialX + 32) / 32) - PerspectiveGround.AnimationFrameCount() "
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "inverted": true,
                        "value": "FlippableCapability::FlippableBehavior::FlippedX"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "Flippable"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ChangeSprite"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "=",
                        "PerspectiveGround.AnimationFrameCount() - trunc((PerspectiveGround. InitialX + 64) / 32)"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "SetNumberObjectVariable"
                      },
                      "parameters": [
                        "PerspectiveGround",
                        "InitialWidth",
                        "=",
                        "PerspectiveGround.Width()"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 52,
            "g": 44,
            "r": 40,
            "textB": 255,
            "textG": 255,
            "textR": 255
          },
          "comment": "This is calculeted by the camera movement."
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "CustomObjects::Tank::Log"
              },
              "parameters": [
                "Player0",
                "ToString(CameraCenterX(_CONSTANTS_.Layers.Main, 0))",
                "",
                ""
              ]
            }
          ],
          "events": [
            {
              "type": "BuiltinCommonInstructions::ForEach",
              "object": "PerspectiveGround",
              "conditions": [],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "SetNumberVariable"
                      },
                      "parameters": [
                        "auxX",
                        "=",
                        "320 - CameraCenterX(_CONSTANTS_.Layers.Main, 0) + PerspectiveGround.InitialX"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "FlippableCapability::FlippableBehavior::FlipX"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "Flippable",
                            ""
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "BuiltinCommonInstructions::CompareNumbers"
                          },
                          "parameters": [
                            "auxX",
                            ">",
                            "320"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "FlippableCapability::FlippableBehavior::FlipX"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "Flippable",
                            "yes"
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "FlippableCapability::FlippableBehavior::FlippedX"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "Flippable"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "frame",
                            "=",
                            "trunc((auxX + 32) / 32) - PerspectiveGround.AnimationFrameCount() "
                          ]
                        },
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "row",
                            "=",
                            "5 - trunc(PerspectiveGround.InitialY / 32)"
                          ]
                        },
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "flipX",
                            "=",
                            "-1"
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "inverted": true,
                            "value": "FlippableCapability::FlippableBehavior::FlippedX"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "Flippable"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "frame",
                            "=",
                            "PerspectiveGround.AnimationFrameCount() - trunc((auxX + 64) / 32)"
                          ]
                        },
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "row",
                            "=",
                            "5 - trunc(PerspectiveGround.InitialY / 32)"
                          ]
                        },
                        {
                          "type": {
                            "value": "SetNumberVariable"
                          },
                          "parameters": [
                            "flipX",
                            "=",
                            "1"
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "ChangeSprite"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "=",
                            "frame"
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "MettreX"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "=",
                            "PerspectiveGround.InitialX + (frame * row * flipX)"
                          ]
                        }
                      ]
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "BuiltinCommonInstructions::CompareNumbers"
                          },
                          "parameters": [
                            "PerspectiveGround.Y()",
                            ">=",
                            "160"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "ResizableCapability::ResizableBehavior::SetWidth"
                          },
                          "parameters": [
                            "PerspectiveGround",
                            "Resizable",
                            "=",
                            "PerspectiveGround.InitialWidth + abs(row)"
                          ]
                        }
                      ],
                      "events": [
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [
                            {
                              "type": {
                                "value": "BuiltinCommonInstructions::Or"
                              },
                              "parameters": [],
                              "subInstructions": [
                                {
                                  "type": {
                                    "value": "BuiltinCommonInstructions::CompareNumbers"
                                  },
                                  "parameters": [
                                    "frame",
                                    ">",
                                    "0"
                                  ]
                                },
                                {
                                  "type": {
                                    "value": "FlippableCapability::FlippableBehavior::FlippedX"
                                  },
                                  "parameters": [
                                    "PerspectiveGround",
                                    "Flippable"
                                  ]
                                }
                              ]
                            }
                          ],
                          "actions": [
                            {
                              "type": {
                                "value": "MettreX"
                              },
                              "parameters": [
                                "PerspectiveGround",
                                "+",
                                "(row * flipX)"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ],
                  "variables": [
                    {
                      "name": "frame",
                      "type": "number",
                      "value": 0
                    },
                    {
                      "name": "row",
                      "type": "number",
                      "value": 0
                    },
                    {
                      "name": "flipX",
                      "type": "number",
                      "value": 0
                    },
                    {
                      "name": "auxX",
                      "type": "number",
                      "value": 0
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "parameters": []
    }
  ]
}